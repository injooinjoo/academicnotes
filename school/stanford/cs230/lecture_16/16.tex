\documentclass[a4paper, 11pt]{article}

% --- íŒ¨í‚¤ì§€ ì„¤ì • ---
\usepackage{kotex} % í•œê¸€ ì§€ì›
\usepackage{geometry} % ì—¬ë°± ì„¤ì •
\geometry{left=25mm, right=25mm, top=25mm, bottom=25mm}
\usepackage{amsmath, amssymb, amsfonts} % ìˆ˜ì‹ íŒ¨í‚¤ì§€
\usepackage{graphicx}
\usepackage{adjustbox}  % í‘œ/ë°•ìŠ¤ í¬ê¸° ì¡°ì ˆ % ì´ë¯¸ì§€ ì‚½ì…
\usepackage{hyperref} % í•˜ì´í¼ë§í¬
\usepackage{xcolor} % ìƒ‰ìƒ ì§€ì›
\usepackage{listings} % ì½”ë“œ ë¸”ë¡
\usepackage[most]{tcolorbox}
\tcbuselibrary{breakable} % ë°•ìŠ¤ ë””ìì¸
\usepackage{enumitem} % ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼
\usepackage{booktabs} % í‘œ ë””ìì¸
\usepackage{array} % í‘œ ì •ë ¬

% --- ìƒ‰ìƒ ì •ì˜ ---
\definecolor{conceptblue}{RGB}{60, 100, 160}
\definecolor{analogygreen}{RGB}{80, 160, 100}
\definecolor{alertred}{RGB}{200, 60, 60}
\definecolor{exampleorange}{RGB}{230, 120, 30}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{backcolour}{rgb}{0.96,0.96,0.96}

% --- ì½”ë“œ ìŠ¤íƒ€ì¼ ì„¤ì • ---
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{analogygreen},
    keywordstyle=\color{conceptblue},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{exampleorange},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=4,
    frame=single
}
\lstset{style=mystyle}

% --- ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì •ì˜ ---
\newtcolorbox{summarybox}[1]{
    colback=conceptblue!5!white,
    colframe=conceptblue!80!black,
    fonttitle=\bfseries,
    title=ğŸ“Œ #1
}

\newtcolorbox{analogybox}[1]{
    colback=analogygreen!5!white,
    colframe=analogygreen!80!black,
    fonttitle=\bfseries,
    title=ğŸ’¡ #1 (ì§ê´€ì  ë¹„ìœ )
}

\newtcolorbox{warningbox}[1]{
    colback=alertred!5!white,
    colframe=alertred!80!black,
    fonttitle=\bfseries,
    title=âš ï¸ #1 (ì˜¤í•´ ë°©ì§€ ê°€ì´ë“œ)
}

\newtcolorbox{tipbox}[1]{
    colback=exampleorange!5!white,
    colframe=exampleorange!80!black,
    fonttitle=\bfseries,
    title=ğŸ’¡ #1 (ì‹¤ì „ íŒ)
}

% --- ë¬¸ì„œ ì •ë³´ ---
\title{\textbf{[CS230] Improving Deep Neural Networks: \\ Mini-batch Gradient Descent}}
\author{Lecturer: Gemini (Integrated Editor)}
\date{}

\begin{document}

\maketitle

% --- 1. ì „ì²´ ëª©ì°¨ (TOC) ---
\section*{ğŸ“š Course Table of Contents}
\begin{itemize}
    \item[Chapter 1-4.] Neural Networks Basics \textit{- Completed}
    \item[\textbf{Chapter 5.}] \textbf{Practical Aspects of Deep Learning (Current Unit)}
    \begin{itemize}
        \item 5.1-5.4 Regularization \& Data Setup \textit{- Completed}
        \item 5.5 Input Normalization \textit{- Completed}
        \item \textbf{5.6 Optimization Algorithms 1: Mini-batch Gradient Descent}
        \begin{itemize}
            \item Batch vs Stochastic vs Mini-batch
            \item Epoch vs Iteration Definition
            \item Why Powers of 2? ($2^n$)
            \item Implementation: Shuffle and Partition
        \end{itemize}
        \item 5.7 Optimization Algorithms 2: Momentum \textit{- Upcoming}
    \end{itemize}
\end{itemize}

\vspace{0.5cm}
\hrule
\vspace{0.5cm}

% --- 3. ì´ì „ ë‹¨ì› ì—°ê²° ---
\section*{ğŸ”— ì§€ë‚œ ì‹œê°„ ë³µìŠµ ë° ì—°ê²°}
ì§€ë‚œ ê°•ì˜ê¹Œì§€ ìš°ë¦¬ëŠ” ê³¼ëŒ€ì í•©ì„ ë§‰ëŠ” 'ë°©ì–´ ê¸°ìˆ (Regularization)'ì„ ìµí˜”ìŠµë‹ˆë‹¤. ì´ì œë¶€í„°ëŠ” ëª¨ë¸ì˜ í•™ìŠµ ì†ë„ë¥¼ ê·¹í•œìœ¼ë¡œ ëŒì–´ì˜¬ë¦¬ëŠ” \textbf{'ê°€ì† ê¸°ìˆ (Optimization)'}ì„ ë‹¤ë£¹ë‹ˆë‹¤.
ë”¥ëŸ¬ë‹ì˜ ì—°ë£ŒëŠ” ë°ì´í„°ì…ë‹ˆë‹¤. ë°ì´í„°ê°€ 1000ë§Œ ê°œë¼ë©´, ê¸°ì¡´ ë°©ì‹(Batch Gradient Descent)ìœ¼ë¡œëŠ” í•œ ê±¸ìŒ ë–¼ëŠ” ë° ë©°ì¹ ì´ ê±¸ë¦½ë‹ˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ ì‘ì€ ë©ì–´ë¦¬ë¡œ ìª¼ê°œì„œ í•™ìŠµí•˜ëŠ” \textbf{ë¯¸ë‹ˆ ë°°ì¹˜(Mini-batch)} ê¸°ë²•ì´ ë“±ì¥í–ˆìŠµë‹ˆë‹¤. ì´ëŠ” í˜„ëŒ€ ë”¥ëŸ¬ë‹ì˜ \textbf{ì‚¬ì‹¤ìƒ í‘œì¤€(Standard)}ì…ë‹ˆë‹¤.

% --- 4. ê°œìš” ---
\section{Unit Overview}
\begin{summarybox}{í•µì‹¬ ëª©í‘œ}
ì´ ë‹¨ì›ì€ ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í•™ìŠµì‹œí‚¤ëŠ” \textbf{ë¯¸ë‹ˆ ë°°ì¹˜ ê²½ì‚¬ í•˜ê°•ë²•}ì„ ë‹¤ë£¹ë‹ˆë‹¤.
\begin{itemize}
    \item \textbf{ë¹„êµ:} Batch(ì „ì²´), Stochastic(1ê°œ), Mini-batch(ë©ì–´ë¦¬)ì˜ ì¥ë‹¨ì ì„ ë¹„êµí•©ë‹ˆë‹¤.
    \item \textbf{ìš©ì–´:} í—·ê°ˆë¦¬ê¸° ì‰¬ìš´ \textbf{Epoch(ì—í­)}ê³¼ \textbf{Iteration(ë°˜ë³µ)}ì˜ ê°œë…ì„ ëª…í™•íˆ í•©ë‹ˆë‹¤.
    \item \textbf{ì›ë¦¬:} ì™œ ë°°ì¹˜ í¬ê¸°ë¥¼ \textbf{$2^n$ (64, 128 ë“±)}ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•˜ë“œì›¨ì–´(CPU/GPU)ê°€ ì¢‹ì•„í•˜ëŠ”ì§€ ë°°ì›ë‹ˆë‹¤.
    \item \textbf{êµ¬í˜„:} ë°ì´í„°ë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ê³ (Shuffle) ë‚˜ëˆ„ëŠ”(Partition) ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
\end{itemize}
\end{summarybox}

% --- 5. ìš©ì–´ ì •ë¦¬ ---
\section{Essential Terminology}
\begin{center}
\begin{tabular}{|c|l|l|}
\hline
\textbf{ìš©ì–´} & \textbf{ì„¤ëª…} & \textbf{ì˜ˆì‹œ ($m=1000$, Batch=100)} \\ \hline
\textbf{Epoch} & ì „ì²´ ë°ì´í„°($m$)ë¥¼ í•œ ë²ˆ ë‹¤ í›‘ëŠ” ê²ƒ. & ì±… 1ê¶Œì„ 1íšŒë… í•¨. \\ \hline
\textbf{Iteration} & íŒŒë¼ë¯¸í„°ë¥¼ í•œ ë²ˆ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒ. & ë¬¸ì œ 100ê°œë¥¼ í’€ê³  ì±„ì í•¨. \\ \hline
\textbf{Mini-batch} & í•œ ë²ˆì˜ Iterationì— ì“°ì´ëŠ” ë°ì´í„° ë¬¶ìŒ. & 1 Epoch = 10 Iterations. \\ \hline
\end{tabular}
\end{center}

% --- 6. í•µì‹¬ ê°œë… ìƒì„¸ ì„¤ëª… ---
\section{Core Concepts: í•™ìŠµ ë°©ì‹ì˜ ìŠ¤í™íŠ¸ëŸ¼}

\subsection{1. The Three Types of Gradient Descent}
ë°ì´í„°ì…‹ í¬ê¸°ê°€ $m$ì¼ ë•Œ, í•œ ë²ˆì˜ ì—…ë°ì´íŠ¸ì— ëª‡ ê°œì˜ ë°ì´í„°ë¥¼ ì“°ëŠ”ê°€?

\begin{itemize}
    \item \textbf{Batch Gradient Descent (BGD):} 
    \begin{itemize}
        \item ë°ì´í„°: ì „ì²´ $m$ê°œ ì‚¬ìš©.
        \item íŠ¹ì§•: ì•ˆì •ì ì´ì§€ë§Œ ë„ˆë¬´ ëŠë¦¼. ë©”ëª¨ë¦¬ ë¶€ì¡± ìœ„í—˜.
    \end{itemize}
    
    \item \textbf{Stochastic Gradient Descent (SGD):} 
    \begin{itemize}
        \item ë°ì´í„°: ë”± 1ê°œ ì‚¬ìš©.
        \item íŠ¹ì§•: ì—„ì²­ ë¹ ë¥´ì§€ë§Œ ë²¡í„°í™”(ë³‘ë ¬ ì²˜ë¦¬) ì´ì ì´ ì—†ìŒ. ì§„ë™ì´ ì‹¬í•¨.
    \end{itemize}
    
    \item \textbf{Mini-batch Gradient Descent:} 
    \begin{itemize}
        \item ë°ì´í„°: $T$ê°œ ì‚¬ìš© (ì˜ˆ: 64, 128).
        \item íŠ¹ì§•: \textbf{Sweet Spot.} BGDì˜ ì•ˆì •ì„± + SGDì˜ ì†ë„ + ë²¡í„°í™” íš¨ìœ¨ì„±ì„ ëª¨ë‘ ì¡ìŒ.
    \end{itemize}
\end{itemize}



\begin{analogybox}{ì‚° ë‚´ë ¤ì˜¤ê¸° ë¹„ìœ }
\begin{itemize}
    \item \textbf{Batch:} ì§€ë„ë¥¼ í¼ì³ ì‚° ì „ì²´ë¥¼ íŒŒì•…í•œ ë’¤, ì •í™•í•˜ê²Œ í•œ ë°œìêµ­ ë‚´ë”›ìŠµë‹ˆë‹¤. (ë„ˆë¬´ ì‹ ì¤‘í•¨)
    \item \textbf{Stochastic:} ëˆˆì„ ê°ê³  ë°œë ê°ê°ë§Œìœ¼ë¡œ ë¯¸ì¹œ ë“¯ì´ ë›°ì–´ë‚´ë ¤ ê°‘ë‹ˆë‹¤. (ë¹ ë¥´ì§€ë§Œ ë¹„í‹€ê±°ë¦¼)
    \item \textbf{Mini-batch:} 100ê±¸ìŒ ì•ë§Œ ë³´ê³  ë°©í–¥ì„ ì¡ì•„ ë‚´ë ¤ê°‘ë‹ˆë‹¤. (ì ë‹¹íˆ ë¹ ë¥´ê³  ì ë‹¹íˆ ì •í™•í•¨)
\end{itemize}
\end{analogybox}

\vspace{0.5cm}\hrule\vspace{0.5cm}

\subsection{2. Why Powers of 2? ($2^n$)}
"êµìˆ˜ë‹˜, ë°°ì¹˜ í¬ê¸°ë¥¼ 100ê°œë‚˜ 50ê°œë¡œ í•˜ë©´ ì•ˆ ë˜ë‚˜ìš”?"
\begin{itemize}
    \item ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ \textbf{ë¹„íš¨ìœ¨ì }ì…ë‹ˆë‹¤.
    \item ì»´í“¨í„° ë©”ëª¨ë¦¬(CPU/GPU)ì˜ ì£¼ì†Œ ì²´ê³„ì™€ ìºì‹œëŠ” \textbf{2ì§„ìˆ˜ ê¸°ë°˜}ì…ë‹ˆë‹¤.
    \item $32, 64, 128, 256, 512$ ë“±ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ë©”ëª¨ë¦¬ ì •ë ¬(Alignment)ì´ ë”± ë§ì•„ë–¨ì–´ì ¸ ì—°ì‚° ì†ë„ê°€ ìµœì í™”ë©ë‹ˆë‹¤.
\end{itemize}

% --- 7. êµ¬í˜„ ì½”ë“œ ---
\section{Implementation: Shuffle and Partition}

ë°ì´í„°ë¥¼ ì„ê³ (Shuffle) ìë¥´ëŠ”(Partition) ê³¼ì •ì„ êµ¬í˜„í•©ë‹ˆë‹¤.
ê°€ì¥ ì¤‘ìš”í•œ ì ì€ \textbf{$X$ì™€ $Y$ë¥¼ ë˜‘ê°™ì€ ìˆœì„œë¡œ ì„ì–´ì•¼ í•œë‹¤}ëŠ” ê²ƒì…ë‹ˆë‹¤.

\begin{lstlisting}[language=Python, caption=Random Mini-batches Generator, breaklines=true]
import numpy as np
import math

def random_mini_batches(X, Y, mini_batch_size=64, seed=0):
    """
    X: (n_x, m), Y: (1, m)
    """
    np.random.seed(seed)            
    m = X.shape[1]  # ë°ì´í„° ìƒ˜í”Œ ìˆ˜
    mini_batches = []
        
    # Step 1: Shuffle (X, Y)
    # 0 ~ m-1 ê¹Œì§€ì˜ ë¬´ì‘ìœ„ ì¸ë±ìŠ¤ ìƒì„±
    permutation = list(np.random.permutation(m))
    
    # ì¤‘ìš”: Xì™€ Yë¥¼ ê°™ì€ ì¸ë±ìŠ¤ë¡œ ì„ìŒ (ì—´ ë‹¨ìœ„)
    shuffled_X = X[:, permutation]
    shuffled_Y = Y[:, permutation].reshape((1, m))

    # Step 2: Partition (ë‚˜ëˆ„ê¸°)
    # ê½‰ ì°¬ ë°°ì¹˜ì˜ ê°œìˆ˜
    num_complete_minibatches = math.floor(m / mini_batch_size) 
    
    for k in range(0, num_complete_minibatches):
        begin = k * mini_batch_size
        end = (k + 1) * mini_batch_size
        
        mini_batch_X = shuffled_X[:, begin : end]
        mini_batch_Y = shuffled_Y[:, begin : end]
        mini_batches.append((mini_batch_X, mini_batch_Y))
    
    # Step 3: Handling the Remainder (ìíˆ¬ë¦¬ ì²˜ë¦¬)
    # ë°ì´í„°ê°€ ë”± ë‚˜ëˆ„ì–´ë–¨ì–´ì§€ì§€ ì•Šì„ ë•Œ ë§ˆì§€ë§‰ ë°°ì¹˜ë¥¼ ì²˜ë¦¬
    if m % mini_batch_size != 0:
        begin = num_complete_minibatches * mini_batch_size
        # ëê¹Œì§€ ë‹¤ ë‹´ê¸°
        mini_batch_X = shuffled_X[:, begin : ]
        mini_batch_Y = shuffled_Y[:, begin : ]
        mini_batches.append((mini_batch_X, mini_batch_Y))
    
    return mini_batches
\end{lstlisting}

% --- 8. FAQ ---
\section{FAQ \& Pitfalls}

\begin{warningbox}{Shuffle ì‹œ ì£¼ì˜ì‚¬í•­}
ì‹œê³„ì—´ ë°ì´í„°(ì£¼ì‹, ë‚ ì”¨, ìŒì„± ë“±)ì²˜ëŸ¼ \textbf{ìˆœì„œ(Time)}ê°€ ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ì ˆëŒ€ ì„ìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤! ê³¼ê±° ë°ì´í„°ë¡œ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•´ì•¼ í•˜ëŠ”ë°, ì„ì–´ë²„ë¦¬ë©´ ë¯¸ë˜ë¥¼ ë³´ê³  ê³¼ê±°ë¥¼ ë§ì¶”ëŠ” ê¼´(Data Leakage)ì´ ë©ë‹ˆë‹¤.
\end{warningbox}

\textbf{Q. ë°°ì¹˜ í¬ê¸°ê°€ ë„ˆë¬´ í¬ë©´(8192 ì´ìƒ) ì–´ë–»ê²Œ ë˜ë‚˜ìš”?} \\
\textbf{A.} GPU ë©”ëª¨ë¦¬ ë¶€ì¡±(OOM Error)ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ëª¨ë¸ì´ ë„ˆë¬´ ì¼ë°˜í™”ëœ íŒ¨í„´ë§Œ ë°°ì›Œì„œ ì„±ëŠ¥(Generalization)ì´ ë–¨ì–´ì§€ëŠ” í˜„ìƒ(Sharp Minima)ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´í†µ 32~512 ì‚¬ì´ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.

% --- 9. ë‹¤ìŒ ë‹¨ì› ì—°ê²° ---
\section*{ğŸ”— ë‹¤ìŒ ë‹¨ê³„ (Next Step)}
ë¯¸ë‹ˆ ë°°ì¹˜ë¥¼ ì“°ë‹ˆ í•™ìŠµì´ ë¹¨ë¼ì¡ŒìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë¹„ìš© í•¨ìˆ˜ ê·¸ë˜í”„ë¥¼ í™•ëŒ€í•´ ë³´ë©´ ì—¬ì „íˆ ì§€ê·¸ì¬ê·¸ë¡œ ì§„ë™í•˜ë©° ë‚´ë ¤ê°‘ë‹ˆë‹¤.

ì´ ì§„ë™ì„ ì¤„ì´ê³ , ë‚´ë¦¬ë§‰ê¸¸ì—ì„œ ê³µì´ êµ´ëŸ¬ê°€ë“¯ \textbf{ê´€ì„±(Inertia)}ì„ ë¶™ì—¬ ë” ë¹ ë¥´ê²Œ ë‚´ë ¤ê°€ê²Œ í•  ìˆ˜ëŠ” ì—†ì„ê¹Œìš”?
ë‹¤ìŒ ì‹œê°„ì—ëŠ” ë‹¨ìˆœí•œ ê²½ì‚¬ í•˜ê°•ë²•ì„ ë„˜ì–´ì„  \textbf{[Optimization] Momentum (ëª¨ë©˜í…€)} ì•Œê³ ë¦¬ì¦˜ì— ëŒ€í•´ ë°°ìš°ê² ìŠµë‹ˆë‹¤.

\vspace{0.5cm}

\begin{summarybox}{ë‹¨ì› ìš”ì•½ (Cheat Sheet)}
\begin{enumerate}
    \item \textbf{Mini-batch GD:} ë°ì´í„°ë¥¼ ì‘ì€ ë¬¶ìŒìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì—…ë°ì´íŠ¸í•œë‹¤. (ì†ë„ + ì•ˆì •ì„±)
    \item \textbf{Power of 2:} ë°°ì¹˜ í¬ê¸°ëŠ” $2^n$ (32, 64, 128...)ì´ í•˜ë“œì›¨ì–´ íš¨ìœ¨ì ì´ë‹¤.
    \item \textbf{Shuffle:} ë§¤ ì—í­ë§ˆë‹¤ ë°ì´í„°ë¥¼ ì„ì–´ì£¼ì–´ì•¼ í•™ìŠµì´ ê³¨ê³ ë£¨ ëœë‹¤.
    \item \textbf{Last Batch:} ë°ì´í„°ê°€ ë‚˜ëˆ„ì–´ë–¨ì–´ì§€ì§€ ì•Šì„ ë•Œ, ë§ˆì§€ë§‰ ìíˆ¬ë¦¬ ë°°ì¹˜ë¥¼ ë²„ë¦¬ì§€ ë§ê³  ì²˜ë¦¬í•´ì•¼ í•œë‹¤.
\end{enumerate}
\end{summarybox}

\end{document}